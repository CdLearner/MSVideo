
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="css/demo.css" />    <!-- common styles -->
    <link rel="stylesheet" type="text/css" href="css/dialog.css" />    <!-- individual effect -->
    <link rel="stylesheet" type="text/css" href="css/dialog-wilma.css" />
    <link rel="stylesheet" type="text/css" href="css/component.css">
    <script src="js/modernizr.custom.js"></script>
    <title>Map</title>
</head>
<body>
<!--查询界面-->
<nav class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-right" id="cbp-spmenu-s2"></nav>
<div class="container">
    <div class="main">
        <section class="buttonset">
            <div class="container">
                <div class="content">

                    <div id="somedialog" class="dialog">
                        <div class="dialog__overlay"></div>
                        <div class="dialog__content">
                            <div class="morph-shape">
                                <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 560 280" preserveAspectRatio="none">
                                    <rect x="3" y="3" fill="none" width="556" height="276"/>
                                </svg>
                            </div>
                            <div class="dialog-inner">
                                <h2><strong>查询结果</strong>共有X条路径</h2>
                                <div><button class="action" data-dialog-close id="OK">确定</button></div>
                            </div>
                        </div>
                    </div>
                </div><!-- /content -->
            </div>
        </section>
    </div>
</div>
<!--播放器-->
<div id="player" class="show" style="position:absolute;right:80;top:200; opacity:1;visibility:hidden;width: 640px; height: 264px;">
    <video id="pp" poster="pic/01-01.jpg"  controls="controls" src="video/1.mp4" type="video/mp4" />
</div>
<div ><button data-dialog="somedialog" class="trigger" id="showLeftPush" style= "position:absolute;right:200;top:200;" onclick="find()">查询</button></div>
<div ><button data-dialog="somedialog" class="trigger" id="showSpecial" style= "position:absolute;right:200;top:400;" onclick="shows()">展示</button></div>
<div ><button data-dialog="somedialog" class="trigger" id="reset" style= "position:absolute;right:200;top:300;" onclick="resets()">重置</button></div>
<div id="tooltip" class="hildden">
    <p><strong>提示：</strong></p>
    <p><span id="value">100</span>%</p>
</div>
<script src="js/d3.min.js"></script>
<script src="js/classie.js"></script>
<script src="js/dialogFx.js"></script>
<!--读取文件并展示-->
<script src="js/ReadFile.js"></script>
<!--各种功能函数-->
<script src="js/yzbx.js"></script>
<script>
    var     menuLeft = document.getElementById( 'cbp-spmenu-s2' ),
            showLeftPush = document.getElementById( 'OK' ),
            body = document.body;
    showLeftPush.onclick = function() {
        classie.toggle( this, 'active' );
		
        classie.toggle( body, 'cbp-spmenu-push-toleft' );
        classie.toggle( menuLeft, 'cbp-spmenu-open' );
		//create_button(3);
    };
    var shows=function(){
        setvalue();
        g.selectAll("image.circle").attr("display", function (d) {
            var result=checkdis(d);
        return result;});
        g.selectAll("path.spot").attr("display",function(d){
            var result=checkdis(d);
            return result;});
    };
    /*(function() {
        var dlgtrigger = document.querySelector( '[data-dialog]' ),
                somedialog = document.getElementById( dlgtrigger.getAttribute( 'data-dialog' ) ),
                dlg = new DialogFx( somedialog );
        dlgtrigger.addEventListener( 'click', dlg.toggle.bind(dlg) );

    })();
	*/
	var find=function(){
		console.log("show the path .................................");
		//显示路径数目并创建相应的按钮
		if(cnt==2&&Nu[0]<Nu[1]){
			var pointNum=dataEvent.length;
			var timeManPathArray=getTimeLinePath(Nu,Na,dataLines,pointNum,dataRoler)
			
			create_button(timeManPathArray.length);
			//d3.select("div.dialog-inner").select("h2").text("共有"+timeManPathArray.length+"条路径");
			//classie.toggle( this, 'active' );
			
			//显示路径
			d3.selectAll("button.path")
			.data(timeManPathArray)
			.on("click",function(d){
				//d 为某条时间线路径
				//g.selectAll("path.time").attr("display","none");
				g.selectAll("path.spot").attr("display","none");
				
				console.log("显示路径 d is "+d);
				for (var i=0;i<d.length;i++)
				{
					console.log(d[i]);
				}
				//var timevalue=getTimeLineValue(dataLine,d);
				//console.log("time value is "+timevalue);
				//dateLines 时间人物线， dataLine 时间线
				var timeManValueArray=getTimeManValueArray(dataLines,d,Na);
				console.log("timeManValueArray is "+timeManValueArray);
				console.log("Na is "+Na);
				g.selectAll("path.spot")
					.data(timeManValueArray)
					.attr("stroke","red")
					.attr("display",function(d){
						if(d==0) return "none";
						else return "block";
					});
			});
		}
		else{
			//提示出错：请选择两个点进行查询
			//d3.select("div.dialog-inner").select("h2").text("<strong>请选择两个点进行查询</strong>");
		}
		
		 var dlgtrigger = document.querySelector( '[data-dialog]' ),
                somedialog = document.getElementById( dlgtrigger.getAttribute( 'data-dialog' ) ),
                dlg = new DialogFx( somedialog );
        dlgtrigger.addEventListener( 'click', dlg.toggle.bind(dlg) );
		
		//classie.toggle( this, 'active' );
		
        classie.toggle( document.body, 'cbp-spmenu-push-toleft' );
        classie.toggle( menuLeft, 'cbp-spmenu-open' );
	}
    function create_button(arr){
        var str="";
        str+="<h3"+">Menu<"+"/h3>";
        for(var i=1;i<=arr;i++){
            str+='<button  class="path" id="no'+i+'" >'+'路径'+i+"<"+'/'+"button>";
        }
    str+='<button  id='+"close" +'>'+'关闭'+"<"+'/'+"button>";

        document.getElementById("cbp-spmenu-s2").innerHTML=str;
        var shutdo = document.getElementById( 'close' );
        shutdo.onclick = function() {

            classie.toggle( this, 'active' );
            classie.toggle( body, 'cbp-spmenu-push-toleft' );
            classie.toggle( menuLeft, 'cbp-spmenu-open' );
        };
    }

</script>
</body>
</html>